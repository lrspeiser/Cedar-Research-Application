#!/bin/bash
set -euo pipefail
HERE="$(cd "$(dirname "$0")" && pwd)"
VENV="$HERE/../Frameworks/venv"
PY="$VENV/bin/python3"
# Redirect stdout/stderr to user logs dir like before
LOG_DIR="$HOME/Library/Logs/CedarPy"
mkdir -p "$LOG_DIR"
TS=$(date -u +%Y%m%dT%H%M%SZ)
LOG_FILE="$LOG_DIR/cedarpy_${TS}.log"
exec >>"$LOG_FILE" 2>&1

# Make sure we default data dir to a writable location
export CEDARPY_DATA_DIR="$HOME/CedarPyData"
# Default host to 127.0.0.1 and port 8000 unless overridden
export CEDARPY_HOST="0.0.0.0"
export CEDARPY_PORT="8000"
export CEDARPY_OPEN_BROWSER="1"

# Run the launcher script using embedded python
exec "$PY" "$HERE/../Resources/run_cedarpy.py"
